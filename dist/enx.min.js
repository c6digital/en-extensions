(()=>{var x=Object.defineProperty;var b=(i,e)=>{for(var t in e)x(i,t,{get:e[t],enumerable:!0})};var w={};b(w,{getENFieldValue:()=>f,getENSupporterData:()=>r,setENFieldValue:()=>g});function f(i,e=!0){let t=window.EngagingNetworks.require._defined.enDefaults.getFieldValue(i);if(t)return t;if(e)return r(i)}function r(i){return window.EngagingNetworks.require._defined.enDefaults.getSupporterData(i)}function g(i,e){window.EngagingNetworks.require._defined.enDefaults.setFieldValue(i,e)}var c=class{constructor(){this.bindTargets=[...document.querySelectorAll("[class*='enx-model:']")],this.shouldRun()&&this.run()}shouldRun(){return this.bindTargets.length>0}run(){let e=this.bindTargets.map(n=>n.classList.value.split("enx-model:")[1].split(" ")[0]);[...new Set(e)].forEach(n=>{[...document.querySelectorAll(`[name="${n}"]`)].forEach(a=>{a.addEventListener("change",()=>{let o=CSS.escape(`enx-model:${n}`),y=[...document.querySelectorAll(`.${o}`)],S=f(n.split(".")[1]);y.forEach(E=>{E.textContent=S})})})})}};var h=class{constructor(e=[]){this.proxies=e,this.shouldRun()&&this.activateProxyFields()}shouldRun(){return this.proxies.length>0}activateProxyFields(){this.proxies.forEach(e=>{let t=e.source.split(".")[1],n=e.target.split(".")[1];document.querySelectorAll(`[name="${e.source}"]`).forEach(s=>{s.addEventListener("change",()=>{g(n,r(t))})}),g(n,r(t))})}};var d=class{constructor(){document.querySelectorAll(".enx-cloak").forEach(e=>{e.classList.remove("enx-cloak")})}};var u=class{constructor(){this.currentStep=0,this.spaTabs=[],this.init()}init(){this.resetTabs(),this.onUrlHit(),this.onBackButton(),this.onClick()}resetTabs(){this.currentStep=0;let e=[...document.querySelectorAll(".spa[class*='spa-name--']")].map(t=>t.className.match(/spa-name--[a-z]*/gi)[0].replace("spa-name--",""));this.spaTabs=[...new Set(e)]}onUrlHit(){if(window.location.hash){let e=new URLSearchParams(location.href);if(document.querySelectorAll(".spa-force-start").length&&!e.has("override-force-spa"))this.changeSpa(".spa-force-start"),history.pushState(null,"","#"),this.log("URL","Show Landing page");else{let t=location.hash.replace("#","");document.querySelectorAll(".spa-name--"+t).length?(this.changeSpa(".spa-name--"+t),this.log("URL",'Show "'+location.hash+'"'),this.setStep(t)):[...document.querySelectorAll(".spa:not(.spa-hidden)")].some(s=>s.className.match(/show:/))?window.location=window.location.href.split("#")[0]:this.changeSpa(document.querySelector(".spa:not(.spa-hidden)"))}}else this.changeSpa(document.querySelector(".spa:not(.spa-hidden)"))}onBackButton(){window.onpopstate=e=>{e.state?(this.changeSpa(".spa-name--"+e.state.page),this.log("Browser",'Show "'+e.state.page+'"'),this.setStep(e.state.page)):[...document.querySelectorAll(".spa:not(.spa-hidden)")].some(n=>n.className.match(/show:/))?location.reload():(this.changeSpa(".spa:not(.spa-hidden)"),this.log("Browser","Show Landing page"),this.setStep(this.spaTabs[0]))}}onClick(){document.querySelectorAll("[spa-destination]").forEach(t=>{t.addEventListener("click",n=>{let s=n.target.getAttribute("spa-destination"),a=this.spaTabs.indexOf(s),o=!n.target.hasAttribute("no-validate")&&this.currentStep<a;if(!(this.currentStep===a||o&&a>this.currentStep+1)){if(o&&!this.validateVisibleFields()){window.dispatchEvent(new CustomEvent("onSpaError",{detail:this.spaTabs[this.currentStep].className}));return}this.changeSpa(".spa-name--"+s),this.log("App",'Show "'+s+'"'),window.dispatchEvent(new CustomEvent("spa:page-view",{detail:[{destination:s,current:this.spaTabs[this.currentStep]}]})),this.setStep(s),s&&this.pushState(s)}})})}changeSpa(e){this.hideAndShow(this.spaTabs[this.currentStep],e)}hideAndShow(e,t){let n=document.querySelector(`.spa-name--${e}`);n&&n.classList.remove("spa-active"),window.scrollTo({top:0,behavior:"smooth"});let s=t instanceof Element?t:document.querySelector(t);s&&s.classList.add("spa-active")}hideImportant(e){e.style.display="none!important"}setStep(e){this.currentStep=this.spaTabs.indexOf(e)}pushState(e){let t={page:e},n="#"+e;history.pushState(t,"",n)}log(e,t){console.log("%cSPA","color: #241C15; background-color: #FF3EBF; padding: 4px; font-weight: 400;"),console.log("Client:	",e),console.log("Action:	",t)}moveToFirstFailedSpa(){let e=document.querySelector(".en__field--validationFailed"),t=e&&e.closest(".spa");if(!t)return;let n=Array.from(t.classList).find(s=>s.includes("spa-name--"));n&&this.changeSpa("."+n)}validateVisibleFields(){return!0}};var p=class{constructor(){this.init(),this.legacyFunctionality()}init(){document.querySelectorAll('[class*="enx-show:"]').forEach(e=>{let t=this.getConditionalClassFromElement(e),n=this.getMatchDetailsFromClass(t);if(!n)return;let s=document.getElementsByName(n.fieldName);s.length===0&&e.classList.add("enx-hidden"),s.forEach(a=>{a.type==="radio"||a.type==="checkbox"?a.value===n.fieldValue&&a.checked?e.classList.remove("enx-hidden"):e.classList.add("enx-hidden"):a.value===n.fieldValue?e.classList.remove("enx-hidden"):e.classList.add("enx-hidden")})}),document.querySelector(".en__component--page")?.addEventListener("input",e=>{let t=e.target;t.matches("input, select, textarea")&&this.checkShowHide(t.name,t.value)})}checkShowHide(e,t){if(!e||!t)return;e==="transaction.donationAmt.other"&&(e="transaction.donationAmt"),document.querySelectorAll('[class*="enx-show:"]').forEach(s=>{let a=this.getConditionalClassFromElement(s),o=this.getMatchDetailsFromClass(a);!o||o.fieldName!==e||(o.fieldValue===t?s.classList.remove("enx-hidden"):s.classList.add("enx-hidden"))})}getConditionalClassFromElement(e){return e.className.split(" ").find(t=>t.includes("enx-show:"))}getMatchDetailsFromClass(e){let n=/enx-show:([^[]+)\[([^[]+)]/g.exec(e);return n?{fieldName:n[1],fieldValue:n[2]}:null}legacyFunctionality(){this.triggerPaymentType(),this.triggerTaxDeductible(),this.triggerRecurringPayment()}showElements(e){document.querySelectorAll(e).forEach(t=>{t.classList.remove("enx-hidden")})}hideElements(e){document.querySelectorAll(e).forEach(t=>{t.classList.add("enx-hidden")})}showRecurringPayment(){if(this.hideElements('[class*="show:recurring--"]'),window.hasOwnProperty("isRegularDonorFlag")&&typeof window.isRegularDonorFlag<"u"){this.showElements(".show\\:recurring--monthly");return}let e=r("recurrpay");if(e==="Y"){this.showElements(".show\\:recurring--monthly");return}else e==="N"&&this.showElements(".show\\:recurring--single");this.showElements(".show\\:recurring--monthly-false")}triggerRecurringPayment(){this.showRecurringPayment(),document.querySelectorAll('input[type=radio][name="transaction.recurrpay"]').forEach(t=>{t.addEventListener("change",()=>{this.showRecurringPayment()})})}showTaxDeductible(){this.hideElements("[class*='show:giftaid--']");let e=r("taxdeductible");e==="Y"?this.showElements(".show\\:giftaid--Y"):e==="N"&&this.showElements(".show\\:giftaid--N")}triggerTaxDeductible(){document.querySelectorAll("input[name='transaction.taxdeductible']").forEach(e=>{e.addEventListener("change",()=>{this.showTaxDeductible()})}),setTimeout(()=>{this.showTaxDeductible()},500)}showPaymentType(){switch(this.hideElements("[class*='show:payment--']"),r("paymenttype")){case"card":this.showElements(".show\\:payment--card");break;case"paypal":this.showElements(".show\\:payment--paypal");break;case"bacs_debit":case"cash":this.showElements(".show\\:payment--directdebit");break;default:return}}triggerPaymentType(){document.querySelectorAll(".en__field--paymenttype").forEach(t=>{["DOMNodeInserted","change"].forEach(n=>{t.addEventListener(n,()=>{let s=()=>{setTimeout(()=>{this.showPaymentType()},500)};s(),document.querySelectorAll('input[type=radio][name="transaction.paymenttype"]').forEach(function(o){o.addEventListener("change",s)})})})}),document.querySelectorAll('input[type=radio][name="transaction.paymenttype"]').forEach(t=>{t.addEventListener("change",()=>{this.showPaymentType()})}),setTimeout(()=>{this.showPaymentType()},500)}};var m=class{constructor(){this.shouldRun()&&this.run()}shouldRun(){return!!document.querySelector(".social-share-native-link")}run(){let e=document.querySelector(".social-share-native-link"),t=document.querySelector(".social-share-native-title"),n=document.querySelector(".social-share-native-description");if("navigator"in window&&"share"in window.navigator){let s=document.createElement("button");s.setAttribute("type","button"),s.setAttribute("aria-label","Share"),s.classList.add("social-share-native-button"),s.textContent="Share",e.appendChild(s),s.addEventListener("click",()=>{let a={url:e.querySelector("p").textContent.trim()};t&&(a.title=t.textContent.trim()),n&&(a.text=n.textContent.trim()),window.navigator.share(a)})}else{let s=document.createElement("button");s.setAttribute("type","button"),s.setAttribute("aria-label","Copy"),s.classList.add("social-share-native-button"),s.textContent="Copy",e.appendChild(s),s.addEventListener("click",()=>{let a=document.createRange();a.selectNode(e.querySelector("p")),window.getSelection().removeAllRanges(),window.getSelection().addRange(a),document.execCommand("copy"),window.getSelection().removeAllRanges(),s.textContent="Copied!",s.setAttribute("disabled","disabled"),setTimeout(()=>{s.textContent="Copy",s.removeAttribute("disabled")},2e3)})}}};var l=class{constructor(e={}){let t={proxies:[],beforeInit:()=>{},beforeCloakRemoval:()=>{},afterInit:()=>{}};this.config={...t,...e},window.hasOwnProperty("ENXPageConfig")&&(this.config={...this.config,...window.ENXPageConfig}),window.ENXConfig=this.config,this.config.beforeInit(),this.waitForEnDefaults().then(()=>{this.helpers=w,this.model=new c,this.proxyFields=new h(this.config.proxies),this.multiStepForm=new u,this.show=new p,this.nativeShare=new m,this.config.beforeCloakRemoval(),this.cloak=new d,this.config.afterInit()})}waitForEnDefaults(){return new Promise(e=>{function t(){window.EngagingNetworks.require._defined.enDefaults!==void 0?e():setTimeout(t,50)}t()})}};window.ENX=l;var $=l;})();
